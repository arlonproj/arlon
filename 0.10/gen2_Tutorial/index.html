
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../dev_setup/">
      
      <link rel="icon" href="../images/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Tutorial - Arlon - GitOps-based Fleet Management for Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    

<script src="../assets/pymdownx-extras/material-extra-theme-8d50d708.js" type="text/javascript"></script>
<script src="../assets/pymdownx-extras/material-extra-3rdparty-a81e7739.js" type="text/javascript"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../assets/pymdownx-extras/extra-3531de4046.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      


<header class="md-header" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label=""
  >
    <a
      href=".."
      title="Arlon - GitOps-based Fleet Management for Kubernetes"
      class="md-header__button md-logo"
      aria-label="Arlon - GitOps-based Fleet Management for Kubernetes"
    >
      
  <img src="../images/pictogram_arlon-stroke.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arlon - GitOps-based Fleet Management for Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
          <a
            href="javascript:toggleScheme();"
            title="Light mode"
            class="light-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="Dark mode"
            class="dark-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="System preference"
            class="system-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34Z"/></svg>
          </a>
           <a
            href="javascript:toggleScheme();"
            title="Unknown scheme"
            class="unknown-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10Z"/></svg>
          </a>
      </div>
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/arlonproj/arlon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arlonproj/arlon
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Arlon - GitOps-based Fleet Management for Kubernetes" class="md-nav__button md-logo" aria-label="Arlon - GitOps-based Fleet Management for Kubernetes" data-md-component="logo">
      
  <img src="../images/pictogram_arlon-stroke.svg" alt="logo">

    </a>
    Arlon - GitOps-based Fleet Management for Kubernetes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arlonproj/arlon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arlonproj/arlon
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../clustertemplate/" class="md-nav__link">
        Cluster Template
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../appprofiles/" class="md-nav__link">
        Application Profile
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        Design
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-cluster-api-cluster-manifest" class="md-nav__link">
    Creating Cluster-API Cluster Manifest
  </a>
  
    <nav class="md-nav" aria-label="Creating Cluster-API Cluster Manifest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#machinedeployment" class="md-nav__link">
    MachineDeployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awsmanagedmachinepool" class="md-nav__link">
    AWSManagedMachinePool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awsmachinepool" class="md-nav__link">
    AWSMachinePool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-manifest" class="md-nav__link">
    Prepare Manifest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manifest-directory-preparation" class="md-nav__link">
    manifest directory preparation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manifest-directory-validation" class="md-nav__link">
    manifest directory validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    Create Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-cluster-with-overrides" class="md-nav__link">
    Create Cluster with Overrides
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-cluster" class="md-nav__link">
    Delete Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cluster-autoscaler-in-the-workload-cluster" class="md-nav__link">
    Enabling Cluster Autoscaler in the workload cluster
  </a>
  
    <nav class="md-nav" aria-label="Enabling Cluster Autoscaler in the workload cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation" class="md-nav__link">
    Bundle creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile-creation" class="md-nav__link">
    Profile creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifest-directory-preparation_1" class="md-nav__link">
    manifest directory preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifest-directory-validation_1" class="md-nav__link">
    manifest directory validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-creation-with-autoscaling-enabled" class="md-nav__link">
    Cluster creation with autoscaling enabled
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues-and-limitations" class="md-nav__link">
    Known issues and limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-more-information" class="md-nav__link">
    For more information
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" tabindex="0" aria-expanded="false">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_testing/" class="md-nav__link">
        End to End Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docs_help/" class="md-nav__link">
        Help with MkDocs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-cluster-api-cluster-manifest" class="md-nav__link">
    Creating Cluster-API Cluster Manifest
  </a>
  
    <nav class="md-nav" aria-label="Creating Cluster-API Cluster Manifest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#machinedeployment" class="md-nav__link">
    MachineDeployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awsmanagedmachinepool" class="md-nav__link">
    AWSManagedMachinePool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awsmachinepool" class="md-nav__link">
    AWSMachinePool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-manifest" class="md-nav__link">
    Prepare Manifest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manifest-directory-preparation" class="md-nav__link">
    manifest directory preparation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manifest-directory-validation" class="md-nav__link">
    manifest directory validation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    Create Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-cluster-with-overrides" class="md-nav__link">
    Create Cluster with Overrides
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-cluster" class="md-nav__link">
    Delete Cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cluster-autoscaler-in-the-workload-cluster" class="md-nav__link">
    Enabling Cluster Autoscaler in the workload cluster
  </a>
  
    <nav class="md-nav" aria-label="Enabling Cluster Autoscaler in the workload cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation" class="md-nav__link">
    Bundle creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile-creation" class="md-nav__link">
    Profile creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifest-directory-preparation_1" class="md-nav__link">
    manifest directory preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifest-directory-validation_1" class="md-nav__link">
    manifest directory validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-creation-with-autoscaling-enabled" class="md-nav__link">
    Cluster creation with autoscaling enabled
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues-and-limitations" class="md-nav__link">
    Known issues and limitations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-more-information" class="md-nav__link">
    For more information
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  
  



<h1 id="tutorial">Tutorial<a class="headerlink" href="#tutorial" title="Permanent link">&para;</a></h1>
<p>This tutorial will go through the step by step process to create a Cluster Template and then deploy one or more AWS EKS Clusters using Arlon. </p>
<p>Arlon allows you to create one or more workload clusters from a <em>Cluster Template</em> that you design and provide in the form of a Cluster API manifest file stored in a git directory. The manifest typically contains multiple related resources that together define an arbitrarily complex cluster. 
If you make subsequent changes to the Cluster Template, workload clusters originally created from it will automatically acquire the changes.</p>
<p>(NOTE: In earlier versions of arlon (before v0.10), <em>Cluster Templates</em> were called <em>Base Clusters</em>.
Some parts of the code still refer to base cluster manifests. This should be considered as a synonym for cluster template manifests.)</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<p>Note: The CAPA version used here is v2.0 and the manifests created here are in accordance with this version.</p>
<p>Refer the <a href="https://github.com/kubernetes-sigs/cluster-api-provider-aws#compatibility-with-cluster-api-and-kubernetes-versions">compatibility matrix for Cluster API provider and CAPA versions</a> for supported versions.</p>
<p>Before deploying a EKS cluster, make sure to setup the AWS Environment as stated in the <a href="https://cluster-api.sigs.k8s.io/user/quick-start.html">quickstart guide for CAPI</a></p>
<p>Please read here to understand the <a href="https://cluster-api.sigs.k8s.io/user/concepts.html?highlight=machine#machine">Cluster API concepts</a> that we will use in rest of this Tutorial. </p>
<h2 id="creating-cluster-api-cluster-manifest">Creating Cluster-API Cluster Manifest<a class="headerlink" href="#creating-cluster-api-cluster-manifest" title="Permanent link">&para;</a></h2>
<p>In this section, we will go through the steps to create a CAPI cluster manifest for the three different types of node pooling constructs that CAPI EKS clusters support.</p>
<h3 id="machinedeployment">MachineDeployment<a class="headerlink" href="#machinedeployment" title="Permanent link">&para;</a></h3>
<p>Here is an example of a manifest file that we can use to create a <em>Cluster Template</em>. This manifest file helps in
creating an EKS cluster with 'Machine Deployment' component from the Cluster API (CAPI). This file has been generated by the following command</p>
<div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>generate<span class="w"> </span>cluster<span class="w"> </span>capi-quickstart<span class="w"> </span>--flavor<span class="w"> </span>eks<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--kubernetes-version<span class="w"> </span>v1.24.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--control-plane-machine-count<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-machine-count<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>&gt;<span class="w"> </span>capi-quickstart.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># YAML</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pods</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cidrBlocks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
<span class="w">  </span><span class="nt">controlPlaneRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-control-plane</span>
<span class="w">  </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-control-plane</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">REGION</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">sshKeyName</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">SSH_KEYNAME</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.24.0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachineDeployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-md-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">        </span><span class="nt">configRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta2</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EKSConfigTemplate</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-md-0</span>
<span class="w">      </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart</span>
<span class="w">      </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSMachineTemplate</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-md-0</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.24.0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSMachineTemplate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-md-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">iamInstanceProfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodes.cluster-api-provider-aws.sigs.k8s.io</span>
<span class="w">      </span><span class="nt">instanceType</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">INSTANCE_TYPE</span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">sshKeyName</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">SSH_KEYNAME</span><span class="p p-Indicator">}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EKSConfigTemplate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">capi-quickstart-md-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<h3 id="awsmanagedmachinepool">AWSManagedMachinePool<a class="headerlink" href="#awsmanagedmachinepool" title="Permanent link">&para;</a></h3>
<p>Initialize the environment for AWSManagedMachinePool as stated <a href="https://cluster-api-aws.sigs.k8s.io/topics/machinepools.html#awsmanagedmachinepool">here</a></p>
<p>Before deploying an EKS cluster, make sure that the MachinePool feature gate is enabled. To do so, run this command:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>deployment<span class="w"> </span>capa-controller-manager<span class="w"> </span>-n<span class="w"> </span>capa-system
</code></pre></div>
<p>In the output, in the feature gates section of the deployment, MachinePool must be set to true.</p>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>deployment<span class="w"> </span>capa-controller-manager<span class="w"> </span>-n<span class="w"> </span>capa-system
..........
..........
--featuregates<span class="o">=</span><span class="nv">EKS</span><span class="o">=</span>true,EKSEnableIAM<span class="o">=</span>false,EKSAllowAddRoles<span class="o">=</span>false,EKSFargate<span class="o">=</span>true,MachinePool<span class="o">=</span>true,EventBridgeInstanceState<span class="o">=</span>false,
<span class="nv">AutoControllerIdentityCreator</span><span class="o">=</span>true,BootstrapFormatIgnition<span class="o">=</span>false,ExternalResourceGC<span class="o">=</span><span class="nb">false</span>
..........
..........
</code></pre></div>
<p>This manifest file helps in deploying an EKS cluster with 'AWSManagedMachinePool' component from the cluster API (CAPI). This file has been generated by the following command</p>
<div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>generate<span class="w"> </span>cluster<span class="w"> </span>awsmanaged-cluster<span class="w"> </span>--kubernetes-version<span class="w"> </span>v1.22.0<span class="w"> </span>--flavor<span class="w"> </span>eks-managedmachinepool<span class="w"> </span>&gt;<span class="w"> </span>manifest.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># YAML</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pods</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cidrBlocks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
<span class="w">  </span><span class="nt">controlPlaneRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-control-plane</span>
<span class="w">  </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-control-plane</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">REGION</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">sshKeyName</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">SSH_KEYNAME</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.22.0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachinePool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-pool-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dataSecretName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">      </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedMachinePool</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-pool-0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedMachinePool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-pool-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<h3 id="awsmachinepool">AWSMachinePool<a class="headerlink" href="#awsmachinepool" title="Permanent link">&para;</a></h3>
<p>An AWSMachinePool corresponds to an AWS AutoScaling Groups, which provides the cloud provider specific resource for orchestrating a group of EC2 machines.</p>
<p>Initialize the environment for AWSMachinePool as stated <a href="https://cluster-api-aws.sigs.k8s.io/topics/machinepools.html#awsmachinepool">here</a></p>
<p>Before deploying an EKS cluster, make sure that the AWSMachinePool feature gate is enabled. To do so, run this command:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>deployment<span class="w"> </span>capa-controller-manager<span class="w"> </span>-n<span class="w"> </span>capa-system
</code></pre></div>
<p>In the output, in the feature gates section of the deployment, MachinePool must be set to true.</p>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>deployment<span class="w"> </span>capa-controller-manager<span class="w"> </span>-n<span class="w"> </span>capa-system
..........
..........
--featuregates<span class="o">=</span><span class="nv">EKS</span><span class="o">=</span>true,EKSEnableIAM<span class="o">=</span>false,EKSAllowAddRoles<span class="o">=</span>false,EKSFargate<span class="o">=</span>true,MachinePool<span class="o">=</span>true,EventBridgeInstanceState<span class="o">=</span>false,
<span class="nv">AutoControllerIdentityCreator</span><span class="o">=</span>true,BootstrapFormatIgnition<span class="o">=</span>false,ExternalResourceGC<span class="o">=</span><span class="nb">false</span>
..........
..........
</code></pre></div>
<p>This manifest file helps in deploying an EKS cluster with 'AWSManagedMachinePool' component from the cluster API (CAPI). This file has been generated by the following command</p>
<div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>generate<span class="w"> </span>cluster<span class="w"> </span>awsmanaged-cluster<span class="w"> </span>--kubernetes-version<span class="w"> </span>v1.22.0<span class="w"> </span>--flavor<span class="w"> </span>eks-machinepool<span class="w"> </span>&gt;<span class="w"> </span>manifest.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># YAML</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pods</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cidrBlocks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
<span class="w">  </span><span class="nt">controlPlaneRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-control-plane</span>
<span class="w">  </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedCluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSManagedControlPlane</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-control-plane</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">REGION</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">sshKeyName</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">SSH_KEYNAME</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.22.0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachinePool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-mp-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">        </span><span class="nt">configRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta2</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EKSConfig</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-mp-0</span>
<span class="w">      </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster</span>
<span class="w">      </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSMachinePool</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-mp-0</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.22.0</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWSMachinePool</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-mp-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">awsLaunchTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">iamInstanceProfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodes.cluster-api-provider-aws.sigs.k8s.io</span>
<span class="w">    </span><span class="nt">instanceType</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">INSTANCE_TYPE</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">sshKeyName</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">SSH_KEYNAME</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">maxSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">  </span><span class="nt">minSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta2</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EKSConfig</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">awsmanaged-cluster-mp-0</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<h2 id="prepare-manifest">Prepare Manifest<a class="headerlink" href="#prepare-manifest" title="Permanent link">&para;</a></h2>
<p>This manifest file needs to be pushed to the workspace repository before the manifest directory is prepped and then validated.</p>
<p>Before a manifest directory can be used as a cluster template, it must first be "prepared" or "prepped"
by Arlon. The "prep" phase makes minor changes to the directory and manifest to help Arlon deploy
multiple copies of the cluster without naming conflicts.</p>
<h2 id="manifest-directory-preparation">manifest directory preparation<a class="headerlink" href="#manifest-directory-preparation" title="Permanent link">&para;</a></h2>
<p>To prepare a git directory to serve as cluster template, use the <code>clustertemplate preparegit</code> command:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>clustertemplate<span class="w"> </span>preparegit<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
<span class="w">            </span><span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
<span class="w">  </span><span class="c1"># using the default alias</span>
arlon<span class="w"> </span>clustertemplate<span class="w"> </span>preparegit<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
<span class="w">  </span><span class="c1"># using the prod alias</span>
arlon<span class="w"> </span>clustertemplate<span class="w"> </span>preparegit<span class="w"> </span>--repo-alias<span class="w"> </span>prod<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
</code></pre></div>
<h2 id="manifest-directory-validation">manifest directory validation<a class="headerlink" href="#manifest-directory-validation" title="Permanent link">&para;</a></h2>
<p>Post the successful preparation of the cluster template manifest directory using <code>clustertemplate preparegit</code>, the cluster template manifest directory needs to be validated before the cluster template is created.</p>
<p>To determine if a git directory is eligible to serve as cluster template, run the <code>clustertemplate validategit</code> command:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>clustertemplate<span class="w"> </span>validategit<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
<span class="w">            </span><span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
<span class="w">  </span><span class="c1"># using the default alias</span>
arlon<span class="w"> </span>clustertemplate<span class="w"> </span>validategit<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
<span class="w">  </span><span class="c1"># using the prod alias</span>
arlon<span class="w"> </span>clustertemplate<span class="w"> </span>validategit<span class="w"> </span>--repo-alias<span class="w"> </span>prod<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>revision<span class="o">]</span>
</code></pre></div>
<h2 id="create-cluster">Create Cluster<a class="headerlink" href="#create-cluster" title="Permanent link">&para;</a></h2>
<p>To create a workload cluster from the Cluster Template:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;clusterName&gt;<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--output-yaml<span class="o">]</span><span class="w"> </span><span class="o">[</span>--profile<span class="w"> </span>&lt;profileName&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>&lt;repoRevision&gt;<span class="o">]</span>
<span class="w">            </span><span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
<span class="w">  </span><span class="c1"># using the default alias</span>
arlon<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;clusterName&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--output-yaml<span class="o">]</span><span class="w"> </span><span class="o">[</span>--profile<span class="w"> </span>&lt;profileName&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>&lt;repoRevision&gt;<span class="o">]</span>
<span class="w">  </span><span class="c1"># using the prod alias</span>
arlon<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;clusterName&gt;<span class="w"> </span>--repo-alias<span class="w"> </span>prod<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span><span class="o">[</span>--output-yaml<span class="o">]</span><span class="w"> </span><span class="o">[</span>--profile<span class="w"> </span>&lt;profileName&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--repo-revision<span class="w"> </span>&lt;repoRevision&gt;<span class="o">]</span>
</code></pre></div>
<h2 id="create-cluster-with-overrides">Create Cluster with Overrides<a class="headerlink" href="#create-cluster-with-overrides" title="Permanent link">&para;</a></h2>
<p>We call the concept of constructing various clusters with patches from the same base manifest as cluster overrides.
The cluster overrides feature is built on top of the existing cluster template design. So, a user can create a cluster from the base manifest using the same command specified in the section above.
Now, to create a cluster with overrides in the base manifest, a user should have the corresponding patch files in a single yaml file in local. Here is an example of a patch file where we want to override replicas count to 2 and change the sshkeyname:</p>
<div class="highlight"><pre><span></span><code>---
apiVersion:<span class="w"> </span>cluster.x-k8s.io/v1beta1
kind:<span class="w"> </span>MachineDeployment
metadata:
<span class="w">  </span>name:<span class="w"> </span>capi-quickstart-eks-md-0
spec:
<span class="w">  </span>replicas:<span class="w"> </span><span class="m">2</span>
---
apiVersion:<span class="w"> </span>controlplane.cluster.x-k8s.io/v1beta1
kind:<span class="w"> </span>AWSManagedControlPlane
metadata:
<span class="w">  </span>name:<span class="w"> </span>capi-quickstart-eks-control-plane
spec:
<span class="w">  </span>sshKeyName:<span class="w"> </span>random
---

<span class="w">  </span><span class="sb">```</span>

Note:<span class="w"> </span>The<span class="w"> </span>metadata<span class="w"> </span>field<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>patch<span class="w"> </span>file<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>same<span class="w"> </span>as<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>metadata<span class="w"> </span>field<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>resources<span class="w"> </span>file.

Refer<span class="w"> </span>to<span class="w"> </span>this<span class="w"> </span><span class="o">[</span>document<span class="o">](</span>https://blog.scottlowe.org/2019/11/12/using-kustomize-with-cluster-api-manifests/<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>know<span class="w"> </span>more<span class="w"> </span>about<span class="w"> </span>patch<span class="w"> </span>files

Command<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>workload<span class="w"> </span>cluster<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>Cluster<span class="w"> </span>Template<span class="w"> </span>manifest<span class="w"> </span>with<span class="w"> </span>overrides<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>manifest<span class="w"> </span>is:

<span class="sb">```</span>shell
arlon<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>&lt;cluster-name&gt;<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repo<span class="w"> </span>url<span class="w"> </span>where<span class="w"> </span>cluster<span class="w"> </span>template<span class="w"> </span>is<span class="w"> </span>present&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;repo<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span>template&gt;<span class="w"> </span>--overrides-path<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>patch<span class="w"> </span>file&gt;<span class="w"> </span>--patch-repo-url<span class="w"> </span>&lt;repo<span class="w"> </span>url<span class="w"> </span>where<span class="w"> </span>patch<span class="w"> </span>file<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>stored&gt;<span class="w"> </span>--patch-repo-path<span class="w"> </span>&lt;repo<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>store<span class="w"> </span>the<span class="w"> </span>patch<span class="w"> </span>files&gt;
<span class="sb">````</span>

Runnning<span class="w"> </span>the<span class="w"> </span>above<span class="w"> </span><span class="nb">command</span><span class="w"> </span>will<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>folder<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>specified<span class="w"> </span>cluster<span class="w"> </span>name<span class="w"> </span><span class="k">in</span><span class="w"> </span>patch<span class="w"> </span>repo<span class="w"> </span>path<span class="w"> </span>of<span class="w"> </span>patch<span class="w"> </span>repo<span class="w"> </span>url<span class="w"> </span>which<span class="w"> </span>contains<span class="w"> </span>the<span class="w"> </span>patch<span class="w"> </span>files,<span class="w"> </span>kustomization.yaml<span class="w"> </span>and<span class="w"> </span>configurations.yaml<span class="w"> </span>which<span class="w"> </span>are<span class="w"> </span>used<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>the<span class="w"> </span>cluster.

Note<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>patch<span class="w"> </span>file<span class="w"> </span>repo<span class="w"> </span>url<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>different<span class="w"> </span>or<span class="w"> </span>same<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>cluster<span class="w"> </span>template<span class="w"> </span>repo<span class="w"> </span>url<span class="w"> </span>acoording<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>requirement<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>user.<span class="w"> </span>A<span class="w"> </span>user<span class="w"> </span>can<span class="w"> </span>use<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>repo<span class="w"> </span>url<span class="w"> </span><span class="k">for</span><span class="w"> </span>string<span class="w"> </span>patch<span class="w"> </span>files<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>cluster.

<span class="c1">## Update Cluster</span>

To<span class="w"> </span>update<span class="w"> </span>the<span class="w"> </span>profiles<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>workload<span class="w"> </span>cluster:

<span class="sb">```</span>shell
<span class="c1"># To add a new profile to the existing cluster</span>
arlon<span class="w"> </span>cluster<span class="w"> </span>ngupdate<span class="w"> </span>&lt;clustername&gt;<span class="w"> </span>--profile<span class="w"> </span>&lt;profilename&gt;
<span class="c1"># To delete an existing profile from the existing cluster</span>
arlon<span class="w"> </span>cluster<span class="w"> </span>ngupdate<span class="w"> </span>&lt;clustername&gt;<span class="w"> </span>--delete-profile
</code></pre></div>
<p>A cluster can be created without any profile associated with the cluster. So, the above commands can be used to add a new profile
to the existing cluster which will create profile app in argocd along with bundle apps associated with the profile.</p>
<p>An existing profile can be deleted from the cluster as well using the above command. Executing this command will delete the profile app and
all the bundles associated with the profile in argocd.</p>
<h2 id="delete-cluster">Delete Cluster<a class="headerlink" href="#delete-cluster" title="Permanent link">&para;</a></h2>
<p>To destroy a workload cluster:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>cluster<span class="w"> </span>delete<span class="w"> </span>&lt;clusterName&gt;
</code></pre></div>
<p>Arlon creates between 2 and 3 ArgoCD application resources to compose a gen2 cluster (the 3rd application, called "profile app", is used when
an optional profile is specified at cluster creation time). When you destroy a gen2 cluster, Arlon will find all related ArgoCD applications
and clean them up.</p>
<p>If the cluster which which is being deleted is a cluster created using patch files, the controller first cleans the git repo where the respective patch files of the cluster are present and then it destroys all the related ArgoCD applications and clean them up.</p>
<h2 id="enabling-cluster-autoscaler-in-the-workload-cluster">Enabling Cluster Autoscaler in the workload cluster<a class="headerlink" href="#enabling-cluster-autoscaler-in-the-workload-cluster" title="Permanent link">&para;</a></h2>
<p>To create a cluster with autoscaler, we need:</p>
<ul>
<li>bundle pointing to the bundle/capi-cluster-autoscaler in the arlon repository.</li>
<li>dynamic profile that contains the above bundle.</li>
<li>a cluster template manifest(that makes use of MachineDeployment and not MachinePools) which has the CAPI annotations for min and max nodes set ( as a part of <code>preparegit</code> or manually add it ).</li>
<li>run <code>arlon cluster create</code> with the repo-path pointing to the cluster template manifest described in the step above, set the profile to  be the one created in step 2 and pass the <code>autoscaler</code> flag.</li>
</ul>
<h3 id="bundle-creation">Bundle creation<a class="headerlink" href="#bundle-creation" title="Permanent link">&para;</a></h3>
<p>Register a dynamic bundle pointing to the bundles/capi-cluster-autoscaler in the Arlon repo.</p>
<p>To enable the cluster-autoscaler bundle, add one more parameter during cluster creation: <code>srcType</code>. This is the ArgoCD-defined application source type (Helm, Kustomize, Directory). In addition to this, the <code>repo-revision</code> parameter should also be set to a stable arlon release branch ( in this case v0.10 ).</p>
<p>This example creates a bundle pointing to the bundles/capi-cluster-autoscaler in Arlon repo</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>bundle<span class="w"> </span>create<span class="w"> </span>cas-bundle<span class="w"> </span>--tags<span class="w"> </span>cas,devel,test<span class="w"> </span>--desc<span class="w"> </span><span class="s2">&quot;CAS Bundle&quot;</span><span class="w"> </span>--repo-url<span class="w"> </span>https://github.com/arlonproj/arlon.git<span class="w"> </span>--repo-path<span class="w"> </span>bundles/capi-cluster-autoscaler<span class="w"> </span>--srctype<span class="w"> </span>helm<span class="w"> </span>--repo-revision<span class="w"> </span>v0.10
</code></pre></div>
<h3 id="profile-creation">Profile creation<a class="headerlink" href="#profile-creation" title="Permanent link">&para;</a></h3>
<p>Create a profile that contains this capi-cluster-autoscaler bundle.</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>profile<span class="w"> </span>create<span class="w"> </span>dynamic-cas<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>--repo-base-path<span class="w"> </span>profiles<span class="w"> </span>--bundles<span class="w"> </span>cas-bundle<span class="w"> </span>--desc<span class="w"> </span><span class="s2">&quot;dynamic cas profile&quot;</span><span class="w"> </span>--tags<span class="w"> </span>examples
</code></pre></div>
<h3 id="manifest-directory-preparation_1">manifest directory preparation<a class="headerlink" href="#manifest-directory-preparation_1" title="Permanent link">&para;</a></h3>
<p>Two additional properties <code>cas-max</code> and <code>cas-min</code> are used to set 2 annotations for Max/Min nodes on MachineDeployment required by the cluster autoscaler for CAPI as a part of the manifest directory preparation. These are the annotations required by the MachineDeployment for autoscaling. </p>
<p>Note: These are the default values for the <code>cas-min</code> and <code>cas-max</code> properties</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>annotations:
<span class="w">     </span>cluster.x-k8s.io/cluster-api-autoscaler-node-group-min-size:<span class="w"> </span><span class="s1">&#39;1&#39;</span>
<span class="w">     </span>cluster.x-k8s.io/cluster-api-autoscaler-node-group-max-size:<span class="w"> </span><span class="s1">&#39;9&#39;</span>
</code></pre></div>
<p>These annotations are added during the preparegit step. If these annotations are already present in the manifest file, then they will not be added again as a part of <code>preparegit</code></p>
<p>Preparing the git directory to serve as the cluster template:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>clustertemplate<span class="w"> </span>preparegit<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span>--cas-min<span class="w"> </span><span class="m">1</span><span class="w"> </span>--cas-max<span class="w"> </span><span class="m">9</span><span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>
</code></pre></div>
<h3 id="manifest-directory-validation_1">manifest directory validation<a class="headerlink" href="#manifest-directory-validation_1" title="Permanent link">&para;</a></h3>
<p>To determine if a git directory is eligible to serve as cluster template, run the <code>clustertemplate validategit</code> command:</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>clustertemplate<span class="w"> </span>validategit<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>
</code></pre></div>
<h3 id="cluster-creation-with-autoscaling-enabled">Cluster creation with autoscaling enabled<a class="headerlink" href="#cluster-creation-with-autoscaling-enabled" title="Permanent link">&para;</a></h3>
<p>To add CAS support for gen2 clusters, the cluster create sub-command of the arlon CLI has a <code>autoscaler</code> flag which deploys the capi-cluster-autoscaler helm chart on the management cluster.</p>
<p>To create a gen2 workload with a cluster-autoscaler pod running, from the cluster template, run this command:</p>
<p>Note: Use the dynamic profile that was created in the previous steps</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>cluster<span class="w"> </span>create<span class="w"> </span>--cluster-name<span class="w"> </span>&lt;clusterName&gt;<span class="w"> </span>--repo-url<span class="w"> </span>&lt;repoUrl&gt;<span class="w"> </span>--repo-path<span class="w"> </span>&lt;pathToDirectory&gt;<span class="w"> </span>--profile<span class="w"> </span>dynamic-cas<span class="w"> </span>--autoscaler
</code></pre></div>
<h2 id="known-issues-and-limitations">Known issues and limitations<a class="headerlink" href="#known-issues-and-limitations" title="Permanent link">&para;</a></h2>
<p>Gen2 clusters are powerful because the cluster template can be arbitrarily complex and feature rich. Since they are fairly
new and still evolving, gen2 clusters have several known limitations relative to gen1.</p>
<ul>
<li>You cannot customize/override any property of the cluster template on the fly when creating a workload cluster, which is an exact clone of the cluster template except for the names of its resources and their namespace. The work-around is to make a copy of the cluster template directory, push the new directory, make the desired changes, commit &amp; push the changes, and register the directory as a new cluster template.</li>
<li>The clusters created directly from the cluster template are completely declarative whereas the clusters which are created using override property are not completely declarative.</li>
<li>If a user passes a different repository for patch repo url from the repo where cluster template is present, argocd won't be able to detect if there are any changes in the cluster template repository but will deect all the chnages in patch repo url for the cluster.</li>
<li>If you modify and commit a change to one or more properties of the cluster template that the underlying Cluster API provider deems as "immutable", new
  workload clusters created from the cluster template will have the modified propert(ies), but ArgoCD will flag existing clusters as OutOfSync, since
  the provider will continually reject attempts to apply the new property values. The existing clusters continue to function, despite appearing unhealthy
  in the ArgoCD UI and CLI outputs.</li>
</ul>
<p>Examples of mutable properties in Cluster API resources:</p>
<ul>
<li>Number of replicas (modification will result in a scale-up / down)</li>
<li>Kubernetes version (modification will result in an upgrade)</li>
</ul>
<p>Examples of immutable properties:</p>
<ul>
<li>Most fields of AWSMachineTemplate (instance type, labels, etc...)</li>
</ul>
<h2 id="for-more-information">For more information<a class="headerlink" href="#for-more-information" title="Permanent link">&para;</a></h2>
<p>For more details on gen2 clusters, refer to the <a href="../clustertemplate/">design document</a>.</p>
<h1 id="arlon-cli-version-information">Arlon CLI Version information<a class="headerlink" href="#arlon-cli-version-information" title="Permanent link">&para;</a></h1>
<p>The Arlon CLI has a version command which shows the current version of the CLI as shown below.</p>
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>version<span class="w"> </span>
Arlon<span class="w"> </span>CLI<span class="w"> </span>Version:<span class="w"> </span><span class="m">0</span>.10.0
</code></pre></div>
<p>The CLI can be downloaded from <a href="https://github.com/arlonproj/arlon/releases">GitHub releases</a> with the latest release of the CLI found <a href="https://github.com/arlonproj/arlon/releases/latest">here</a>.
The official releases follow a semver versioning scheme. All patches to a minor version are non-breaking changes. For instance, the transition from <code>v0.9.9</code> to <code>v0.9.10</code> will not introduce any breaking changes.
However, a change in either minor or the major versions doesn't guarantee this.</p>
<p>To check if there are patches available for the current minor version of the CLI, Arlon has a <code>version check</code> command. If upgrade patch for a CLI minor version is available, the command will request to download the newer version.
For example:
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>version<span class="w"> </span>check
Arlon<span class="w"> </span>CLI<span class="w"> </span>version<span class="w"> </span><span class="m">0</span>.10.0<span class="w"> </span>is<span class="w"> </span>outdated.<span class="w"> </span>New<span class="w"> </span>patch<span class="w"> </span><span class="m">0</span>.10.1<span class="w"> </span>available
</code></pre></div>
Otherwise, the CLI reports that it is up-to date.
<div class="highlight"><pre><span></span><code>arlon<span class="w"> </span>version<span class="w"> </span>check
<span class="s2">&quot;Arlon CLI version 0.10.0 is up-to-date</span>
</code></pre></div></p>





                
  

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        

<footer class="md-footer">
  
    <nav
      class="md-footer__inner md-grid"
      aria-label=""
    >
      
        <a
          href="../installation/"
          class="md-footer__link md-footer__link--prev"
          rel="prev"
        >
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        <a
          href="../dev_setup/"
          class="md-footer__link md-footer__link--next"
          rel="next"
        >
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Setup
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        with emoji by
        <a href="https://github.com/twitter/twemoji" target="_blank" rel="noopener">
          Twemoji
        </a>
      </div>
      <div class="md-social">
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.8.4/dist/mermaid.min.js"></script>
      
        <script src="../assets/pymdownx-extras/extra-loader-52693605.js"></script>
      
    
  </body>
</html>