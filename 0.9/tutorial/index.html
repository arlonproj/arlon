
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../images/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Tutorial (gen1) - Arlon - GitOps-based Fleet Management for Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    

<script src="../assets/pymdownx-extras/material-extra-theme-8d50d708.js" type="text/javascript"></script>
<script src="../assets/pymdownx-extras/material-extra-3rdparty-a81e7739.js" type="text/javascript"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../assets/pymdownx-extras/extra-34c51d7bc1.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-gen1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      


<header class="md-header" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >
    <a
      href=".."
      title="Arlon - GitOps-based Fleet Management for Kubernetes"
      class="md-header__button md-logo"
      aria-label="Arlon - GitOps-based Fleet Management for Kubernetes"
    >
      
  <img src="../images/pictogram_arlon-stroke.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arlon - GitOps-based Fleet Management for Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial (gen1)
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
          <a
            href="javascript:toggleScheme();"
            title="Light mode"
            class="light-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="Dark mode"
            class="dark-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="System preference"
            class="system-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34Z"/></svg>
          </a>
           <a
            href="javascript:toggleScheme();"
            title="Unknown scheme"
            class="unknown-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10Z"/></svg>
          </a>
      </div>
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/arlonproj/arlon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arlonproj/arlon
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Arlon - GitOps-based Fleet Management for Kubernetes" class="md-nav__button md-logo" aria-label="Arlon - GitOps-based Fleet Management for Kubernetes" data-md-component="logo">
      
  <img src="../images/pictogram_arlon-stroke.svg" alt="logo">

    </a>
    Arlon - GitOps-based Fleet Management for Kubernetes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arlonproj/arlon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arlonproj/arlon
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        Design
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../clustertemplate/" class="md-nav__link">
        Cluster template
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial (gen1)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial (gen1)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-specs" class="md-nav__link">
    Cluster specs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bundles" class="md-nav__link">
    Bundles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiles" class="md-nav__link">
    Profiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clusters-gen1" class="md-nav__link">
    Clusters (gen1)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavioral-differences-between-static-and-dynamic-bundles-profiles" class="md-nav__link">
    Behavioral differences between static and dynamic bundles &amp; profiles
  </a>
  
    <nav class="md-nav" aria-label="Behavioral differences between static and dynamic bundles &amp; profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-bundle" class="md-nav__link">
    Static bundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-profile" class="md-nav__link">
    Dynamic profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-bundle" class="md-nav__link">
    Dynamic bundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-profile" class="md-nav__link">
    Static profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-updates-and-upgrades" class="md-nav__link">
    Cluster updates and upgrades
  </a>
  
    <nav class="md-nav" aria-label="Cluster updates and upgrades">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clusterspec" class="md-nav__link">
    Clusterspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile" class="md-nav__link">
    Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cluster-autoscaler-in-the-workload-cluster" class="md-nav__link">
    Enabling Cluster Autoscaler in the workload cluster
  </a>
  
    <nav class="md-nav" aria-label="Enabling Cluster Autoscaler in the workload cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation" class="md-nav__link">
    Bundle creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile-creation" class="md-nav__link">
    Profile creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterspec-creation" class="md-nav__link">
    Clusterspec creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-creation" class="md-nav__link">
    Cluster creation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gen2_Tutorial/" class="md-nav__link">
        Tutorial (gen2)
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docs_help/" class="md-nav__link">
        Help with Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster-specs" class="md-nav__link">
    Cluster specs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bundles" class="md-nav__link">
    Bundles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiles" class="md-nav__link">
    Profiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clusters-gen1" class="md-nav__link">
    Clusters (gen1)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behavioral-differences-between-static-and-dynamic-bundles-profiles" class="md-nav__link">
    Behavioral differences between static and dynamic bundles &amp; profiles
  </a>
  
    <nav class="md-nav" aria-label="Behavioral differences between static and dynamic bundles &amp; profiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-bundle" class="md-nav__link">
    Static bundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-profile" class="md-nav__link">
    Dynamic profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-bundle" class="md-nav__link">
    Dynamic bundle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-profile" class="md-nav__link">
    Static profile
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-updates-and-upgrades" class="md-nav__link">
    Cluster updates and upgrades
  </a>
  
    <nav class="md-nav" aria-label="Cluster updates and upgrades">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clusterspec" class="md-nav__link">
    Clusterspec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile" class="md-nav__link">
    Profile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enabling-cluster-autoscaler-in-the-workload-cluster" class="md-nav__link">
    Enabling Cluster Autoscaler in the workload cluster
  </a>
  
    <nav class="md-nav" aria-label="Enabling Cluster Autoscaler in the workload cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bundle-creation" class="md-nav__link">
    Bundle creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profile-creation" class="md-nav__link">
    Profile creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterspec-creation" class="md-nav__link">
    Clusterspec creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster-creation" class="md-nav__link">
    Cluster creation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  <a href="https://github.com/arlonproj/arlon/edit/v0.9/docs/tutorial.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="tutorial-gen1">Tutorial (gen1)<a class="headerlink" href="#tutorial-gen1" title="Permanent link">&para;</a></h1>
<p>This assumes that you plan to deploy workload clusters on AWS cloud, with
Cluster API ("CAPI") as the cluster orchestration API provider.
Also ensure you have set up a <a href="https://github.com/arlonproj/arlon/blob/main/docs/architecture.md#workspace-repository">workspace repository</a>, and it is registered as a git repo in ArgoCD. The tutorial will assume the existence of these environment variables:</p>
<ul>
<li><code>${ARLON_REPO}</code>: where the arlon repo is locally checked out</li>
<li><code>${WORKSPACE_REPO}</code>: where the workspace repo is locally checked out</li>
<li><code>${WORKSPACE_REPO_URL}</code>: the workspace repo's git URL. It typically looks like <code>https://github.com/${username}/${reponame}.git</code></li>
<li><code>${CLOUD_REGION}</code>: the region where you want to deploy example clusters and workloads (e.g. us-west-2)</li>
<li><code>${SSH_KEY_NAME}</code>: the name of a public ssh key name registered in your cloud account, to enable ssh to your cluster nodes</li>
</ul>
<p>Additionally, for examples assuming <code>arlon git register</code>, "default" and a "prod" git repo aliases will also be given.</p>
<p>_Note: for the best experience, make sure your workspace repo is configured
to send change notifications to ArgoCD via a webhook. See the Installation section for details.</p>
<h2 id="cluster-specs">Cluster specs<a class="headerlink" href="#cluster-specs" title="Permanent link">&para;</a></h2>
<p>We first create a few cluster specs with different combinations of API providers
and cluster types (kubeadm vs EKS).
One of the cluster specs is for an unconfigured API provider (Crossplane);
this is for illustrative purposes, since we will not use it in this tutorial.</p>
<div class="highlight"><pre><span></span><code>arlon clusterspec create capi-kubeadm-3node --api capi --cloud aws --type kubeadm --kubeversion v1.21.10 --nodecount <span class="m">3</span> --nodetype t2.medium --tags devel,test --desc <span class="s2">&quot;3 node kubeadm for dev/test&quot;</span> --region <span class="si">${</span><span class="nv">CLOUD_REGION</span><span class="si">}</span> --sshkey <span class="si">${</span><span class="nv">SSH_KEY_NAME</span><span class="si">}</span>
arlon clusterspec create capi-eks --api capi --cloud aws --type eks --kubeversion v1.21.10 --nodecount <span class="m">2</span> --nodetype t2.large --tags staging --desc <span class="s2">&quot;2 node eks for general purpose&quot;</span> --region <span class="si">${</span><span class="nv">CLOUD_REGION</span><span class="si">}</span> --sshkey <span class="si">${</span><span class="nv">SSH_KEY_NAME</span><span class="si">}</span>
arlon clusterspec create xplane-eks-3node --api xplane --cloud aws --type eks --kubeversion v1.21.10 --nodecount <span class="m">4</span> --nodetype t2.small --tags experimental --desc <span class="s2">&quot;4 node eks managed by crossplane&quot;</span> --region <span class="si">${</span><span class="nv">CLOUD_REGION</span><span class="si">}</span> --sshkey <span class="si">${</span><span class="nv">SSH_KEY_NAME</span><span class="si">}</span>
</code></pre></div>
<p>Ensure you can now list the cluster specs:</p>
<div class="highlight"><pre><span></span><code>$ arlon clusterspec list
NAME                APIPROV  CLOUDPROV  TYPE     KUBEVERSION  NODETYPE   NODECNT  MSTNODECNT  SSHKEY  CAS    CASMIN  CASMAX  TAGS          DESCRIPTION
capi-eks            capi     aws        eks      v1.21.10     t2.large   <span class="m">2</span>        <span class="m">3</span>           leb     <span class="nb">false</span>  <span class="m">1</span>       <span class="m">9</span>       staging       <span class="m">2</span> node eks <span class="k">for</span> general purpose
capi-kubeadm-3node  capi     aws        kubeadm  v1.21.10     t2.medium  <span class="m">3</span>        <span class="m">3</span>           leb     <span class="nb">false</span>  <span class="m">1</span>       <span class="m">9</span>       devel,test    <span class="m">3</span> node kubeadm <span class="k">for</span> dev/test
xplane-eks-3node    xplane   aws        eks      v1.21.10     t2.small   <span class="m">4</span>        <span class="m">3</span>           leb     <span class="nb">false</span>  <span class="m">1</span>       <span class="m">9</span>       experimental  <span class="m">4</span> node eks managed by crossplane
</code></pre></div>
<h2 id="bundles">Bundles<a class="headerlink" href="#bundles" title="Permanent link">&para;</a></h2>
<p>First create a static bundle containing raw YAML for the <code>guestbook</code>
sample application from this example file:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="si">${</span><span class="nv">ARLON_REPO</span><span class="si">}</span>
arlon bundle create guestbook-static --tags applications --desc <span class="s2">&quot;guestbook app&quot;</span> --from-file examples/bundles/guestbook.yaml
</code></pre></div>
<p>(<em>Note: the YAML is simply a concatenation of the files found in the
<a href="https://github.com/argoproj/argocd-example-apps/tree/master/guestbook">ArgoCD Example Apps repo</a></em>)</p>
<p>To illustrate the difference between static and dynamic bundles, we create
a dynamic version of the same application, this time using a reference to a
git directory containing the YAML. We could point it directly to the copy in the
<a href="https://github.com/argoproj/argocd-example-apps/tree/master/guestbook">ArgoCD Example Apps repo</a>,
but we'll want to make modifications to it, so we instead create a new directory
to host our own copy in our workspace directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO</span><span class="si">}</span>
mkdir -p bundles/guestbook
cp <span class="si">${</span><span class="nv">ARLON_REPO</span><span class="si">}</span>/examples/bundles/guestbook.yaml bundles/guestbook
git add bundles/guestbook
git commit -m <span class="s2">&quot;add guestbook&quot;</span>
git push origin main
</code></pre></div>
<div class="highlight"><pre><span></span><code>arlon bundle create guestbook-dynamic --tags applications --desc <span class="s2">&quot;guestbook app (dynamic)&quot;</span> --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --repo-path bundles/guestbook
            <span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
  <span class="c1"># using the default alias</span>
arlon bundle create guestbook-dynamic --tags applications --desc <span class="s2">&quot;guestbook app (dynamic)&quot;</span> --repo-path bundles/guestbook
  <span class="c1"># using the prod alias</span>
arlon bundle create guestbook-dynamic --tags applications --desc <span class="s2">&quot;guestbook app (dynamic)&quot;</span> --repo-path bundles/guestbook --repo-alias prod
</code></pre></div>
<p>Next, we create a static bundle for another "dummy" application,
an Ubuntu pod (OS version: "Xenial") that does nothing but print the date-time
in an infinite sleep loop:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="si">${</span><span class="nv">ARLON_REPO</span><span class="si">}</span>
arlon bundle create xenial-static --tags applications --desc <span class="s2">&quot;xenial pod&quot;</span> --from-file examples/bundles/xenial.yaml
</code></pre></div>
<p>Finally, we create a bundle for the Calico CNI, which provides pod networking.
Some types of clusters (e.g. kubeadm) require a CNI provider to be installed
onto a newly created cluster, so encapsulating the provider as a bundle will
give us a flexible way to install it. We download a known copy from the
authoritative source and store it the workspace repo in order to create a
dynamic bundle from it:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO</span><span class="si">}</span>
mkdir -p bundles/calico
curl https://docs.projectcalico.org/v3.21/manifests/calico.yaml -o bundles/calico/calico.yaml
git add bundles/calico
git commit -m <span class="s2">&quot;add calico&quot;</span>
git push origin main
</code></pre></div>
<div class="highlight"><pre><span></span><code>arlon bundle create calico --tags networking,cni --desc <span class="s2">&quot;Calico CNI&quot;</span> --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --repo-path bundles/calico
            <span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
  <span class="c1"># using the default alias</span>
arlon bundle create calico --tags networking,cni --desc <span class="s2">&quot;Calico CNI&quot;</span> --repo-path bundles/calico
  <span class="c1"># using the prod alias</span>
arlon bundle create calico --tags networking,cni --desc <span class="s2">&quot;Calico CNI&quot;</span> --repo-path bundles/calico --repo-alias prod
</code></pre></div>
<p>List your bundles to verify they were correctly entered:</p>
<div class="highlight"><pre><span></span><code>$ arlon bundle list
NAME               TYPE     TAGS                 REPO-URL                                             REPO-PATH              DESCRIPTION
calico             dynamic  networking,cni       <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>                                bundles/calico         Calico CNI
guestbook-dynamic  dynamic  applications         <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>                                bundles/guestbook      guestbook app <span class="o">(</span>dynamic<span class="o">)</span>
guestbook-static   static   applications         <span class="o">(</span>N/A<span class="o">)</span>                                                <span class="o">(</span>N/A<span class="o">)</span>                  guestbook app
xenial-static      static   applications         <span class="o">(</span>N/A<span class="o">)</span>                                                <span class="o">(</span>N/A<span class="o">)</span>                  ubuntu pod <span class="k">in</span> infinite sleep loop
</code></pre></div>
<h2 id="profiles">Profiles<a class="headerlink" href="#profiles" title="Permanent link">&para;</a></h2>
<p>We can now create profiles to group bundles into useful, deployable sets.
First, create a static profile containing bundles xenial-static and guestbook-static:</p>
<div class="highlight"><pre><span></span><code>arlon profile create static-1 --static --bundles guestbook-static,xenial-static --desc <span class="s2">&quot;static profile 1&quot;</span> --tags examples
</code></pre></div>
<p>Secondly, create a dynamic version of the same profile. We'll store the compiled
form of the profile in the <code>profiles/dynamic-1</code> directory of the workspace repo. We don't create
it manually; instead, the arlon CLI will create it for us, and it will push
the change to git:</p>
<div class="highlight"><pre><span></span><code>arlon profile create dynamic-1 --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --repo-base-path profiles --bundles guestbook-static,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
            <span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
  <span class="c1"># using the default alias</span>
arlon profile create dynamic-1 --repo-base-path profiles --bundles guestbook-static,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
  <span class="c1"># using the prod alias</span>
arlon profile create dynamic-1 --repo-alias prod --repo-base-path profiles --bundles guestbook-static,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
</code></pre></div>
<p><em>Note: the <code>--repo-base-path profiles</code> option tells <code>arlon</code> to create the profile
under a base directory <code>profiles/</code> (to be created if it doesn't exist). That
is in fact the default value of that option, so it is not necessary to specify
it in this case.</em></p>
<p>To verify that the compiled profile was created correctly:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO</span><span class="si">}</span>
$ git pull
$ tree profiles
profiles
├── dynamic-1
│   ├── mgmt
│   │   ├── Chart.yaml
│   │   └── templates
│   │       ├── guestbook-dynamic.yaml
│   │       ├── placeholder_configmap.yaml
│   │       └── xenial.yaml
│   └── workload
│       └── xenial
│           └── xenial.yaml
<span class="o">[</span>...<span class="o">]</span>
</code></pre></div>
<p>Since <code>xenial</code> is a static bundle, a copy of its YAML was stored in <code>workload/xenial/xenial.yaml</code>.
This is not done for <code>guestbook-dynamic</code> because it is dynamic.</p>
<p>Finally, we create another variant of the same profile, with the only difference
being the addition of Calico bundle. It'll be used on clusters that need a CNI provider:</p>
<div class="highlight"><pre><span></span><code>arlon profile create dynamic-2-calico --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --repo-base-path profiles --bundles calico,guestbook-dynamic,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
            <span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
  <span class="c1"># using the default alias</span>
arlon profile create dynamic-2-calico --repo-base-path profiles --bundles calico,guestbook-dynamic,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
  <span class="c1"># using the prod alias</span>
arlon profile create dynamic-2-calico --repo-alias prod --repo-base-path profiles --bundles calico,guestbook-dynamic,xenial-static --desc <span class="s2">&quot;dynamic test 1&quot;</span> --tags examples
</code></pre></div>
<p>Listing the profiles should show:</p>
<div class="highlight"><pre><span></span><code>$ arlon profile list
NAME              TYPE     BUNDLES                                 REPO-URL               REPO-PATH                  TAGS         DESCRIPTION
dynamic-1         dynamic  guestbook-static,xenial-static          <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  profiles/dynamic-1         examples     dynamic <span class="nb">test</span> <span class="m">1</span>
dynamic-2-calico  dynamic  calico,guestbook-static,xenial-static   <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  profiles/dynamic-2-calico  examples     dynamic <span class="nb">test</span> <span class="m">1</span>
static-1          static   guestbook-dynamic,xenial-static         <span class="o">(</span>N/A<span class="o">)</span>                  <span class="o">(</span>N/A<span class="o">)</span>                      examples     static profile <span class="m">1</span>
</code></pre></div>
<h2 id="clusters-gen1">Clusters (gen1)<a class="headerlink" href="#clusters-gen1" title="Permanent link">&para;</a></h2>
<p>We are now ready to deploy our first cluster. It will be of type EKS. Since
EKS clusters come configured with pod networking out of the box, we choose
a profile that does not include Calico: <code>dynamic-1</code>.
When deploying a cluster, arlon creates in git a Helm chart containing
the manifests for creating and bootstrapping the cluster.
Arlon then creates an ArgoCD App referencing the chart, thereby relying
on ArgoCD to orchestrate the whole process of deploying and configuring the cluster.
The arlon <code>deploy</code> command
accepts a git URL and path for this git location. Any git repo can be used (so long
as it's registered with ArgoCD), but we'll use the workspace cluster for
convenience:</p>
<div class="highlight"><pre><span></span><code>arlon cluster deploy --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --cluster-name eks-1 --profile dynamic-1 --cluster-spec capi-eks
            <span class="c1"># OR</span>
<span class="c1"># using repository aliases</span>
  <span class="c1"># using the default alias</span>
arlon cluster deploy --cluster-name eks-1 --profile dynamic-1 --cluster-spec capi-eks
  <span class="c1"># using the prod alias</span>
arlon cluster deploy --repo-alias prod --cluster-name eks-1 --profile dynamic-1 --cluster-spec capi-eks
</code></pre></div>
<p>The git directory hosting the cluster Helm chart is created as a subdirectory
of a base path in the repo. The base path can be specified with <code>--base-path</code>, but
we'll leave it unspecified in order to use the default value of <code>clusters</code>.
Consequently, this example produces the directory <code>clusters/eks-1/</code> in the repo.
To verify its presence:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO</span><span class="si">}</span>
$ git pull
$ tree clusters/eks-1
clusters/eks-1
└── mgmt
    ├── charts
    │   ├── capi-aws-eks
    │   │   ├── Chart.yaml
    │   │   └── templates
    │   │       └── cluster.yaml
    │   ├── capi-aws-kubeadm
    │   │   ├── Chart.yaml
    │   │   └── templates
    │   │       └── cluster.yaml
    │   └── xplane-aws-eks
    │       ├── Chart.yaml
    │       └── templates
    │           ├── cluster.yaml
    │           └── network.yaml
    ├── Chart.yaml
    ├── templates
    │   ├── clusterregistration.yaml
    │   ├── ns.yaml
    │   ├── profile.yaml
    │   └── rbac.yaml
    └── values.yaml
</code></pre></div>
<p>The chart contains several subcharts under <code>mgmt/charts/</code>,
one for each supported type of cluster. Only one of them will be enabled,
in this case <code>capi-aws-eks</code> (Cluster API on AWS with type EKS).</p>
<p>At this point, the cluster is provisioning and can be seen in arlon and AWS EKS:</p>
<div class="highlight"><pre><span></span><code>$ arlon cluster list
NAME       CLUSTERSPEC  PROFILE  
eks-1      capi-eks     dynamic-1

$ aws eks list-clusters
<span class="o">{</span>
    <span class="s2">&quot;clusters&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;eks-1_eks-1-control-plane&quot;</span>,
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>Eventually, it will also be seen as a registered cluster in argocd, but this
won't be visible for a while, because the cluster is not registered until
its control plane (the Kubernetes API) is ready:</p>
<div class="highlight"><pre><span></span><code>$ argocd cluster list
SERVER                                                                    NAME        VERSION  STATUS      MESSAGE
https://9F07DC211252C6F7686F90FA5B8B8447.gr7.us-west-2.eks.amazonaws.com  eks-1       <span class="m">1</span>.18+    Successful  
https://kubernetes.default.svc                                            <span class="k">in</span>-cluster  <span class="m">1</span>.20+    Successful  
</code></pre></div>
<p>To monitor the progress of the cluster deployment, check the status of
the ArgoCD app of the same name:</p>
<div class="highlight"><pre><span></span><code>$ argocd app list
NAME                         CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                   PATH                                          TARGET
eks-1                        https://kubernetes.default.svc  default    default  Synced  Healthy  Auto-Prune  &lt;none&gt;      <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  clusters/eks-1/mgmt                           main
eks-1-guestbook-static                                       default    default  Synced  Healthy  Auto-Prune  &lt;none&gt;      <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  profiles/dynamic-1/workload/guestbook-static  HEAD
eks-1-profile-dynamic-1      https://kubernetes.default.svc  argocd     default  Synced  Healthy  Auto-Prune  &lt;none&gt;      <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  profiles/dynamic-1/mgmt                       HEAD
eks-1-xenial                                                 default    default  Synced  Healthy  Auto-Prune  &lt;none&gt;      <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>  profiles/dynamic-1/workload/xenial            HEAD
</code></pre></div>
<p>The top-level app <code>eks-1</code> is the root of all argocd apps that make up the
cluster and its configuration contents. The next level app <code>eks-1-profile-dynamic-1</code>
represents the profile, and its children apps <code>eks-1-guestbook-static</code> and <code>eks-1-xenial</code>
correspond to the bundles.</p>
<p>Note: The overall tree-like organization of the apps and their health status
can be visually observed in the ArgoCD web user interface._</p>
<p>The cluster is fully deployed once those apps are all <code>Synced</code> and <code>Healthy</code>.
An EKS cluster typically takes 10-15 minutes to finish deploying.</p>
<h2 id="behavioral-differences-between-static-and-dynamic-bundles-profiles">Behavioral differences between static and dynamic bundles &amp; profiles<a class="headerlink" href="#behavioral-differences-between-static-and-dynamic-bundles-profiles" title="Permanent link">&para;</a></h2>
<h3 id="static-bundle">Static bundle<a class="headerlink" href="#static-bundle" title="Permanent link">&para;</a></h3>
<p>A change to a static bundle does not affect existing clusters using that bundle
(through a profile). To illustrate this, bring up the ArgoCD UI and
open the detailed view of the <code>eks-1-guestbook-static</code> application,
which applies the <code>guestbook-static</code> bundle to the <code>eks-1</code> cluster.
Note that there is only one <code>guestbook-ui</code> pod.</p>
<p>Next, update the <code>guestbook-static</code> bundle to have 3 replicas of the pod:</p>
<div class="highlight"><pre><span></span><code>arlon bundle update guestbook-static --from-file examples/bundles/guestbook-3replicas.yaml
</code></pre></div>
<p>Note that the UI continues to show one pod. Only new clusters consuming
this bundle will have the 3 replicas.</p>
<h3 id="dynamic-profile">Dynamic profile<a class="headerlink" href="#dynamic-profile" title="Permanent link">&para;</a></h3>
<p>Before discussing dynamic bundles, we take a small detour to introduce
dynamic profiles, since this will help understand the relationship between
profiles and bundles.
To illustrate how a profile can be updated, we remove <code>guestbook-static</code> bundle
from <code>dynamic-1</code> by specifying a new bundle set:</p>
<div class="highlight"><pre><span></span><code>arlon profile update dynamic-1 --bundles xenial
</code></pre></div>
<p>Since the old bundle set was <code>guestbook-static,xenial-static</code>, that command resulted
in the removal of <code>guestbook-static</code> from the profile.
In the UI, observe the <code>eks-1-profile-dynamic-1</code> app going through Sync
and Progressing phases, eventually reaching the healthy (green) state.
And most importantly, the <code>eks-1-guestbook-static</code> app is gone. The reason
this real-time change to the cluster was possible is that the <code>dynamic-1</code>
profile is dynamic, meaning any change to its composition results in arlon
updating the corresponding compiled Helm chart in git. ArgoCD detects this
git change and propagates the app / configuration updates to the cluster.</p>
<p>If the profile were of the static type, a change in its composition (the
set of bundles) would <em>not</em> have affected existing clusters using that profile.
It would only affect new clusters created with the profile.</p>
<h3 id="dynamic-bundle">Dynamic bundle<a class="headerlink" href="#dynamic-bundle" title="Permanent link">&para;</a></h3>
<p>To illustrate the defining characteristic of a dynamic bundle, we first add
<code>guestbook-dynamic</code> to <code>dynamic-1</code>:</p>
<div class="highlight"><pre><span></span><code>arlon profile update dynamic-1 --bundles xenial,guestbook-dynamic
</code></pre></div>
<p>Observe the re-appearance of the guestbook application, which is managed
by the <code>eks-1-guestbook-dynamic</code> ArgoCD app. A detailed view of the app
shows 1 guestbook-ui pod. Remember that a dynamic bundle's
manifest content is stored in git. Use these commands to change the number
of pod replicas to 3:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO</span><span class="si">}</span>
git pull <span class="c1"># to get all latest changes pushed by arlon</span>
vim bundles/guestbook/guestbook.yaml <span class="c1"># edit to change deployment&#39;s replicas to 3</span>
git commit -am <span class="s2">&quot;increase guestbook replicas&quot;</span>
git push origin main
</code></pre></div>
<p>Observe the number of pods increasing to 3 in the UI. Any existing cluster
consuming this dynamic bundle will be updated similarly, regardless of whether
the bundle is consumed via a dynamic or static profile.</p>
<h3 id="static-profile">Static profile<a class="headerlink" href="#static-profile" title="Permanent link">&para;</a></h3>
<p>Finally, a profile can be static. It means that it has no corresponding
"compiled" component (a Helm chart) living in git. When a cluster is
deployed using a static profile, the set of bundles (whether static or
dynamic) it receives is determined by the bundle set defined by the profile at deployment
time, and will not change in the future, even if the profile is updated to
a new set at a later time.</p>
<h2 id="cluster-updates-and-upgrades">Cluster updates and upgrades<a class="headerlink" href="#cluster-updates-and-upgrades" title="Permanent link">&para;</a></h2>
<p>The <code>arlon cluster update [flags]</code> command allows you to make changes to
an existing cluster. The clusterspec, profile, or both can change, provided
that the following rules and guidelines are followed.</p>
<h3 id="clusterspec">Clusterspec<a class="headerlink" href="#clusterspec" title="Permanent link">&para;</a></h3>
<p>There are two scenarios. In the first, the clusterspec name associated with the
cluster hasn't changed, meaning the cluster is using the same clusterspec.
However, some properties of the clusterspec's properties have changed since
the cluster was deployed or last updated, using <code>arlon clusterspec update</code>
Arlon supports updating the cluster
to use updated values of the following properties:</p>
<ul>
<li>kubernetesVersion</li>
<li>nodeCount</li>
<li>nodeType</li>
</ul>
<p><em>Note: Updating the cluster is not allowed if other properties of its clusterspec
(e.g. cluster orchestration API provider, cloud, cluster type, region, pod CIDR block, etc...)
have changed, however new clusters can always be created/deployed using the
changed clusterspec.</em></p>
<p>A change in <code>kubernetesVersion</code> will result in a cluster upgrade/downgrade.
There are some restrictions and caveats you need to be aware of:</p>
<ul>
<li>The specific Kubernetes version must be supported by the particular implementation and release of the underlying cluster orchestration API provider cloud, and cluster type.</li>
<li>In general, the control plane will be upgraded first</li>
<li>Existing nodes are not typically not upgraded to the new Kubernetes version.
  Only new nodes (added as part of manual <code>nodeCount</code> change or autoscaling)</li>
</ul>
<p>In the second scenario, as part of an update operation, you may choose to
associate the cluster with a different clusterspec altogether.
The rule governing the allowed property changes remains the same: the cluster
update operation is allowed if, relative to the previously associated clusterspec, the new clusterspec's properties differ only in the values listed above.</p>
<h3 id="profile">Profile<a class="headerlink" href="#profile" title="Permanent link">&para;</a></h3>
<p>You can specify a completely different profile when updating a cluster.
All bundles previously used will be removed from the cluster, and new ones
specified by the new profile will be applied. This is regardless of whether
the old and new profiles are static or dynamic.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<p>These sequence of commands updates a clusterspec to a newer Kubernetes version
and a higher node count, then upgrades the cluster to the newer specifications:</p>
<div class="highlight"><pre><span></span><code>arlon clusterspec update capi-eks --nodecount <span class="m">3</span> --kubeversion v1.19.15
arlon cluster update eks-1
</code></pre></div>
<p>Note that the 2nd command didn't need any flags because the clusterspec used
is the same as before.</p>
<p>This example updates a cluster to use a new profile <code>my-new-profile</code>:</p>
<div class="highlight"><pre><span></span><code>arlon cluster update eks-1 --profile my-new-profile
</code></pre></div>
<h2 id="enabling-cluster-autoscaler-in-the-workload-cluster">Enabling Cluster Autoscaler in the workload cluster<a class="headerlink" href="#enabling-cluster-autoscaler-in-the-workload-cluster" title="Permanent link">&para;</a></h2>
<h3 id="bundle-creation">Bundle creation<a class="headerlink" href="#bundle-creation" title="Permanent link">&para;</a></h3>
<p>Register a dynamic bundle pointing to the bundles/capi-cluster-autoscaler in the Arlon repo.</p>
<p>The capi-cluster-autoscaler bundle requires the name of the cluster, so that it knows what namespace in the management cluster to scan for CAPI resources. To enable the cluster-autoscaler bundle, add one more parameter during cluster creation: <code>srcType</code>. This is the ArgoCD-defined application source type (Helm, Kustomize, Directory).</p>
<p>This example creates a bundle pointing to the bundles/capi-cluster-autoscaler in Arlon repo</p>
<div class="highlight"><pre><span></span><code>arlon bundle create cas-bundle --tags cas,devel,test --desc <span class="s2">&quot;CAS Bundle&quot;</span> --repo-url https://github.com/arlonproj/arlon.git --repo-path bundles/capi-cluster-autoscaler --srctype helm
</code></pre></div>
<h3 id="profile-creation">Profile creation<a class="headerlink" href="#profile-creation" title="Permanent link">&para;</a></h3>
<p>Create a profile that contains this capi-cluster-autoscaler bundle.</p>
<div class="highlight"><pre><span></span><code>arlon profile create dynamic-cas --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --repo-base-path profiles --bundles cas-bundle --desc <span class="s2">&quot;dynamic cas profile&quot;</span> --tags examples
</code></pre></div>
<h3 id="clusterspec-creation">Clusterspec creation<a class="headerlink" href="#clusterspec-creation" title="Permanent link">&para;</a></h3>
<p>Create a clusterspec with CAPI as ApiProvider and autoscaling enabled.In addition to this, the ClusterAutoscaler(Min|Max)Nodes properties are used to set 2 annotations on MachineDeployment required by the cluster autoscaler for CAPI.</p>
<div class="highlight"><pre><span></span><code>arlon clusterspec create cas-spec --api capi --cloud aws --type eks --kubeversion v1.21.10 --nodecount <span class="m">2</span> --nodetype t2.medium --tags devel,test --desc <span class="s2">&quot;dev/test&quot;</span>  --region <span class="si">${</span><span class="nv">CLOUD_REGION</span><span class="si">}</span> --sshkey <span class="si">${</span><span class="nv">SSH_KEY_NAME</span><span class="si">}</span> --casenabled
</code></pre></div>
<h3 id="cluster-creation">Cluster creation<a class="headerlink" href="#cluster-creation" title="Permanent link">&para;</a></h3>
<p>Deploy a cluster from this cluster spec and profile created in the previous steps.</p>
<div class="highlight"><pre><span></span><code>arlon cluster deploy --repo-url <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> --cluster-name cas-cluster --profile dynamic-cas --cluster-spec cas-spec
</code></pre></div>
<p>Consequently, this example produces the directory <code>clusters/cas-cluster/</code> in the repo. This will contain the capi-autoscaler subchart and manifests <code>mgmt/charts/</code>.
To verify its contents:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>
$ tree clusters/cas-cluster
clusters/cas-cluster
└── mgmt
    ├── Chart.yaml
    ├── charts
    │   ├── capi-aws-eks
    │   │   ├── Chart.yaml
    │   │   └── templates
    │   │       └── cluster.yaml
    │   ├── capi-aws-kubeadm
    │   │   ├── Chart.yaml
    │   │   └── templates
    │   │       └── cluster.yaml
    │   ├── capi-cluster-autoscaler
    │   │   ├── Chart.yaml
    │   │   └── templates
    │   │       ├── callhomeconfig.yaml
    │   │       └── rbac.yaml
    │   └── xplane-aws-eks
    │       ├── Chart.yaml
    │       └── templates
    │           ├── cluster.yaml
    │           └── network.yaml
    ├── templates
    │   ├── clusterregistration.yaml
    │   ├── ns.yaml
    │   ├── profile.yaml
    │   └── rbac.yaml
    └── values.yaml
</code></pre></div>
<p>At this point, the cluster is provisioning. To monitor the progress of the cluster deployment, check the status of
the ArgoCD app of the same name. Eventually, the ArgoCD apps will be synced and healthy.</p>
<div class="highlight"><pre><span></span><code>$ argocd app list

NAME                           CLUSTER                         NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                            PATH                             TARGET
cas-cluster                    https://kubernetes.default.svc  default    default Synced  Healthy  Auto-Prune  &lt;none&gt;  <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span>   clusters/cas-cluster/mgmt        main
cas-cluster-cas-bundle           cas-cluster                 default    default  Synced     Healthy  Auto-Prune  &lt;none&gt;   https://github.com/arlonproj/arlon.git   bundles/capi-cluster-autoscaler  HEAD
cas-cluster-profile-dynamic-cas  https://kubernetes.default.svc  argocd     default  Synced     Healthy  Auto-Prune  &lt;none&gt;      <span class="si">${</span><span class="nv">WORKSPACE_REPO_URL</span><span class="si">}</span> profiles/dynamic-cas/mgmt
</code></pre></div>





                
  

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        

<footer class="md-footer">
  
    <nav
      class="md-footer__inner md-grid"
      aria-label="Footer"
    >
      
        <a
          href="../installation/"
          class="md-footer__link md-footer__link--prev"
          rel="prev"
        >
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        <a
          href="../gen2_Tutorial/"
          class="md-footer__link md-footer__link--next"
          rel="next"
        >
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Tutorial (gen2)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        with emoji by
        <a href="https://github.com/twitter/twemoji" target="_blank" rel="noopener">
          Twemoji
        </a>
      </div>
      <div class="md-social">
  
</div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.8.4/dist/mermaid.min.js"></script>
      
        <script src="../assets/pymdownx-extras/extra-loader-52693605.js"></script>
      
    
    
  </body>
</html>